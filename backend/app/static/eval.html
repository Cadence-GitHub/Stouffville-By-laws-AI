<!DOCTYPE html>
<html lang="en">
<head>
    <title>Bylaw AI SME Evaluation</title>
    <link rel="stylesheet" href="eval.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body class="eval-bg">
<div class="eval-main-layout">
    <!-- Collapsible Navigation Sidebar (always visible) -->
    <nav id="question-nav" class="question-nav" aria-label="Question Navigation">
        <button id="nav-toggle" class="nav-toggle" title="Toggle navigation" aria-label="Toggle navigation">&#9776;</button>
        <!-- Navigation items will be rendered here by JS -->
    </nav>
    <!-- Main Content Area (header/buttons + main) -->
    <div class="eval-main-content">
        <div id="eval-controls">
            <div class="eval-header">
                <div class="eval-logo">Bylaw AI</div>
                <h1>Bylaw AI SME Evaluation</h1>
                <div class="subtitle">Evaluator: <span id="evaluator-label"></span></div>
                <div class="evaluator-select" style="display: none;">
                    <label for="evaluator">Switch evaluator:</label>
                    <select id="evaluator"></select>
                </div>
                <div id="progress"></div>
            </div>
            <div class="top-nav-buttons">
                <div class="nav-group">
                    <button id="prev-btn" class="secondary-btn">‚Üê Previous</button>
                    <button id="next-btn" class="secondary-btn">Next ‚Üí</button>
                </div>
                <div class="nav-group">
                    <button type="button" id="bookmark-btn" class="secondary-btn">üîñ Bookmark</button>
                    <button type="button" id="skip-btn" class="secondary-btn">‚è≠Ô∏è Skip</button>
                </div>
            </div>
        </div>
        <main class="eval-content" aria-label="Main Evaluation Content">
            <div class="eval-container">
                <div id="welcome-screen" class="card">
                    <h1>Welcome to Bylaw AI SME Evaluation</h1>
                    <div class="subtitle">Help us improve by evaluating AI-generated bylaw answers.</div>
                    <div class="form-row">
                        <label for="welcome-user-select">Select your name:</label>
                        <select id="welcome-user-select">
                            <option value="">-- Select an existing user --</option>
                        </select>
                    </div>
                    <div class="form-row or-divider"><span>or</span></div>
                    <div class="form-row">
                        <label for="welcome-name">Add a new name:</label>
                        <input type="text" id="welcome-name" placeholder="Your name">
                    </div>
                    <div class="form-row">
                        <button id="welcome-proceed" class="primary-btn">Proceed</button>
                    </div>
                    <div id="welcome-error" class="error-msg"></div>
                </div>
                <div id="eval-ui" style="display:none;">
                    <div id="eval-form-container" class="card">
                        <div id="question-block">
                            <h2>Question</h2>
                            <div id="question-text"></div>
                        </div>
                        <!-- AI Answer Card and Bylaw Panel -->
                        <div id="answerContainer"></div>
                        <div id="bylaw-panel" class="bylaw-panel" aria-label="Bylaw Viewer" tabindex="-1">
                            <div id="panel-resizer" class="panel-resizer"></div>
                            <div class="panel-header">
                                <h3 id="bylaw-title">Bylaw Details</h3>
                                <button id="close-panel" class="close-button" title="Close viewer" aria-label="Close bylaw viewer">√ó</button>
                            </div>
                            <div class="panel-content" id="bylaw-content"></div>
                        </div>
                        <!-- END: AI Answer Card and Bylaw Panel -->
                        <div id="ai-response-block" style="display:none;"></div>
                        <form id="eval-form">
                            <div class="form-row">
                                <label>
                                    Response Generated?
                                    <div class="tooltip">
                                        <span class="info-icon">i</span>
                                        <div class="tooltip-content">
                                            <h4>Response Generated</h4>
                                            <p><strong>Type:</strong> Yes/No</p>
                                            <p><strong>Question:</strong> Did the system produce any response to the prompt?</p>
                                            <div class="rating-guidelines">
                                                <strong>Guidelines:</strong><br>
                                                ‚Ä¢ <strong>Yes:</strong> System provided a response (even if poor quality)<br>
                                                ‚Ä¢ <strong>No:</strong> System failed, timed out, or returned an error
                                            </div>
                                            <p><em>Note: This is a basic technical functionality check. A "No" here means the other criteria cannot be evaluated.</em></p>
                                        </div>
                                    </div>
                                </label>
                                <select id="response_generated" required>
                                    <option value="">Select</option>
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label>
                                    Accuracy (1-5)
                                    <div class="tooltip">
                                        <span class="info-icon">i</span>
                                        <div class="tooltip-content">
                                            <h4>Accuracy</h4>
                                            <p><strong>Scale:</strong> 1-5</p>
                                            <p><strong>Question:</strong> How factually correct is the response regarding bylaw content?</p>
                                            <div class="rating-guidelines">
                                                <strong>Rating Guidelines:</strong><br>
                                                ‚Ä¢ <strong>5 - Excellent:</strong> All facts, bylaw numbers, dates, and requirements are completely accurate<br>
                                                ‚Ä¢ <strong>4 - Good:</strong> Mostly accurate with minor errors that don't affect the core meaning<br>
                                                ‚Ä¢ <strong>3 - Fair:</strong> Generally accurate but contains some notable errors or imprecise information<br>
                                                ‚Ä¢ <strong>2 - Poor:</strong> Several significant factual errors that could mislead users<br>
                                                ‚Ä¢ <strong>1 - Unacceptable:</strong> Mostly inaccurate information that could cause serious problems
                                            </div>
                                            <div class="what-to-check">
                                                <strong>What to Check:</strong><br>
                                                ‚Ä¢ Bylaw numbers and years match actual documents<br>
                                                ‚Ä¢ Quoted requirements match the source bylaws<br>
                                                ‚Ä¢ Dates, fees, and specific measurements are correct<br>
                                                ‚Ä¢ Cross-references to other bylaws are accurate
                                            </div>
                                            <div class="example-issues">
                                                <strong>Example Issues:</strong><br>
                                                ‚Ä¢ Wrong bylaw number cited<br>
                                                ‚Ä¢ Incorrect fee amounts<br>
                                                ‚Ä¢ Outdated information presented as current<br>
                                                ‚Ä¢ Misstatement of legal requirements
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <input type="number" id="accuracy" min="1" max="5">
                            </div>
                            <div class="form-row">
                                <label>
                                    Hallucination (1-5, lower is better)
                                    <div class="tooltip">
                                        <span class="info-icon">i</span>
                                        <div class="tooltip-content">
                                            <h4>Hallucination</h4>
                                            <p><strong>Scale:</strong> 1-5 (Reverse Scale - Lower is Better)</p>
                                            <p><strong>Question:</strong> How much made-up or non-existent information does the response contain?</p>
                                            <div class="rating-guidelines">
                                                <strong>Rating Guidelines:</strong><br>
                                                ‚Ä¢ <strong>1 - Excellent:</strong> No hallucinated content; all information can be verified in source documents<br>
                                                ‚Ä¢ <strong>2 - Good:</strong> Minor embellishments that don't affect accuracy<br>
                                                ‚Ä¢ <strong>3 - Fair:</strong> Some unverifiable details but core information is sound<br>
                                                ‚Ä¢ <strong>4 - Poor:</strong> Notable fabricated information mixed with real content<br>
                                                ‚Ä¢ <strong>5 - Unacceptable:</strong> Significant made-up content, fake bylaw citations, or invented procedures
                                            </div>
                                            <div class="what-to-check">
                                                <strong>What to Check:</strong><br>
                                                ‚Ä¢ Are all cited bylaws real and findable?<br>
                                                ‚Ä¢ Do quoted procedures actually exist in the bylaws?<br>
                                                ‚Ä¢ Are referenced departments, forms, or processes legitimate?<br>
                                                ‚Ä¢ Does the AI claim knowledge it shouldn't have?
                                            </div>
                                            <div class="example-issues">
                                                <strong>Example Issues:</strong><br>
                                                ‚Ä¢ Citations to non-existent bylaws (e.g., "Bylaw 2024-999")<br>
                                                ‚Ä¢ Made-up department names or contact information<br>
                                                ‚Ä¢ Invented procedures not found in actual bylaws<br>
                                                ‚Ä¢ Fabricated exceptions or special cases
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <input type="number" id="hallucination" min="1" max="5">
                            </div>
                            <div class="form-row">
                                <label>
                                    Completeness (1-5)
                                    <div class="tooltip">
                                        <span class="info-icon">i</span>
                                        <div class="tooltip-content">
                                            <h4>Completeness</h4>
                                            <p><strong>Scale:</strong> 1-5</p>
                                            <p><strong>Question:</strong> How thoroughly does the response address all aspects of the user's question?</p>
                                            <div class="rating-guidelines">
                                                <strong>Rating Guidelines:</strong><br>
                                                ‚Ä¢ <strong>5 - Excellent:</strong> Fully addresses all parts of the question with comprehensive coverage<br>
                                                ‚Ä¢ <strong>4 - Good:</strong> Addresses main question well, minor gaps in coverage<br>
                                                ‚Ä¢ <strong>3 - Fair:</strong> Covers most important aspects but misses some relevant information<br>
                                                ‚Ä¢ <strong>2 - Poor:</strong> Partial answer that leaves significant questions unanswered<br>
                                                ‚Ä¢ <strong>1 - Unacceptable:</strong> Barely addresses the question or focuses on wrong aspects
                                            </div>
                                            <div class="what-to-check">
                                                <strong>What to Check:</strong><br>
                                                ‚Ä¢ Are all parts of multi-part questions answered?<br>
                                                ‚Ä¢ Does it cover relevant exceptions or special cases?<br>
                                                ‚Ä¢ Are important caveats or limitations mentioned?<br>
                                                ‚Ä¢ Does it address practical implementation aspects?
                                            </div>
                                            <div class="example-issues">
                                                <strong>Example Issues:</strong><br>
                                                ‚Ä¢ Answering only part of a complex question<br>
                                                ‚Ä¢ Missing important exceptions to rules<br>
                                                ‚Ä¢ Failing to mention required permits or approvals<br>
                                                ‚Ä¢ Not addressing timeline or process questions
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <input type="number" id="completeness" min="1" max="5">
                            </div>
                            <div class="form-row">
                                <label>
                                    Authoritative (1-5)
                                    <div class="tooltip">
                                        <span class="info-icon">i</span>
                                        <div class="tooltip-content">
                                            <h4>Authoritative</h4>
                                            <p><strong>Scale:</strong> 1-5</p>
                                            <p><strong>Question:</strong> How well does the response demonstrate proper legal authority and appropriate tone?</p>
                                            <div class="rating-guidelines">
                                                <strong>Rating Guidelines:</strong><br>
                                                ‚Ä¢ <strong>5 - Excellent:</strong> Clear bylaw citations, appropriate legal language, confident but measured tone<br>
                                                ‚Ä¢ <strong>4 - Good:</strong> Good use of citations with mostly appropriate authority claims<br>
                                                ‚Ä¢ <strong>3 - Fair:</strong> Some authority shown but could be stronger or more precise<br>
                                                ‚Ä¢ <strong>2 - Poor:</strong> Weak authority, vague references, or inappropriate confidence levels<br>
                                                ‚Ä¢ <strong>1 - Unacceptable:</strong> No clear authority, makes claims without basis, or misleading confidence
                                            </div>
                                            <div class="what-to-check">
                                                <strong>What to Check:</strong><br>
                                                ‚Ä¢ Are specific bylaw numbers and sections cited?<br>
                                                ‚Ä¢ Is the tone appropriately authoritative without overstepping?<br>
                                                ‚Ä¢ Does it distinguish between current and historical bylaws?<br>
                                                ‚Ä¢ Are limitations of the AI's authority acknowledged when appropriate?
                                            </div>
                                            <div class="example-issues">
                                                <strong>Example Issues:</strong><br>
                                                ‚Ä¢ Vague references like "municipal bylaws require..." without specifics<br>
                                                ‚Ä¢ Making definitive statements about complex legal interpretations<br>
                                                ‚Ä¢ Not distinguishing between active and repealed bylaws<br>
                                                ‚Ä¢ Claiming authority the AI system doesn't have
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <input type="number" id="authoritative" min="1" max="5">
                            </div>
                            <div class="form-row">
                                <label>
                                    Overall Usefulness (1-5)
                                    <div class="tooltip">
                                        <span class="info-icon">i</span>
                                        <div class="tooltip-content">
                                            <h4>Overall Usefulness</h4>
                                            <p><strong>Scale:</strong> 1-5</p>
                                            <p><strong>Question:</strong> How helpful would this response be to a resident or town officer?</p>
                                            <div class="rating-guidelines">
                                                <strong>Rating Guidelines:</strong><br>
                                                ‚Ä¢ <strong>5 - Excellent:</strong> Highly useful, actionable information that fully serves the user's needs<br>
                                                ‚Ä¢ <strong>4 - Good:</strong> Very useful with clear guidance, minor improvements possible<br>
                                                ‚Ä¢ <strong>3 - Fair:</strong> Moderately useful but could be clearer or more practical<br>
                                                ‚Ä¢ <strong>2 - Poor:</strong> Limited usefulness, may confuse more than help<br>
                                                ‚Ä¢ <strong>1 - Unacceptable:</strong> Not useful, potentially harmful or misleading
                                            </div>
                                            <div class="what-to-check">
                                                <strong>What to Consider:</strong><br>
                                                ‚Ä¢ Would this help a resident understand what they need to do?<br>
                                                ‚Ä¢ Is the language accessible to non-lawyers?<br>
                                                ‚Ä¢ Does it provide next steps or contact information when appropriate?<br>
                                                ‚Ä¢ Would this reduce follow-up questions to town staff?
                                            </div>
                                            <div class="example-issues">
                                                <strong>Example of High Usefulness:</strong><br>
                                                ‚Ä¢ Clear explanation of permit requirements<br>
                                                ‚Ä¢ Step-by-step process guidance<br>
                                                ‚Ä¢ Relevant contact information included<br>
                                                ‚Ä¢ Appropriate level of detail for the audience
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <input type="number" id="usefulness" min="1" max="5">
                            </div>
                            <div class="form-row">
                                <label>
                                    Pass/Fail
                                    <div class="tooltip">
                                        <span class="info-icon">i</span>
                                        <div class="tooltip-content">
                                            <h4>Pass/Fail</h4>
                                            <p><strong>Type:</strong> Pass/Fail</p>
                                            <p><strong>Question:</strong> Overall, does this response meet the minimum quality standards for public use?</p>
                                            <div class="rating-guidelines">
                                                <strong>Guidelines:</strong><br>
                                                ‚Ä¢ <strong>Pass:</strong> Response meets minimum quality standards and could be safely provided to the public<br>
                                                ‚Ä¢ <strong>Fail:</strong> Response has significant issues that would make it inappropriate for public use
                                            </div>
                                            <div class="what-to-check">
                                                <strong>Consider for Pass:</strong><br>
                                                ‚Ä¢ Response is factually accurate (Accuracy 3+)<br>
                                                ‚Ä¢ Minimal hallucination (Hallucination 2 or better)<br>
                                                ‚Ä¢ Addresses the main question (Completeness 3+)<br>
                                                ‚Ä¢ Provides useful guidance (Usefulness 3+)
                                            </div>
                                            <div class="example-issues">
                                                <strong>Automatic Fail Indicators:</strong><br>
                                                ‚Ä¢ Significant factual errors (Accuracy 1-2)<br>
                                                ‚Ä¢ Highdocon levels (Hallucination 4-5)<br>
                                                ‚Ä¢ Completely misses the question (Completeness 1-2)<br>
                                                ‚Ä¢ Could mislead or harm users (Usefulness 1-2)
                                            </div>
                                            <p><em>Note: This is your overall judgment call. A response can have some issues but still pass if it provides value to users.</em></p>
                                        </div>
                                    </div>
                                </label>
                                <select id="pass_fail">
                                    <option value="">Select</option>
                                    <option value="Pass">Pass</option>
                                    <option value="Fail">Fail</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label>SME Comments</label>
                                <textarea id="comments" rows="3"></textarea>
                            </div>
                            <div class="form-row eval-action-row">
                                <div class="save-btn-group">
                                    <button type="submit" class="primary-btn">Submit Evaluation</button>
                                    <button type="button" id="submit-next-btn" class="primary-btn">Submit and Next</button>
                                </div>
                            </div>
                        </form>
                        <div id="eval-status-indicator"></div>
                        <div id="eval-status"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <!-- Bylaw Viewer Backdrop for mobile overlay -->
    <div id="bylaw-backdrop" class="bylaw-backdrop" tabindex="-1" aria-hidden="true"></div>
</div>

<!-- Bookmark Warning Modal -->
<div id="bookmark-warning-modal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close" id="bookmark-modal-close">&times;</span>
    <h2>Bookmark Warning</h2>
    <p>If you bookmark this question, any values you have entered but not submitted will be cleared. To save your work, please submit your evaluation before bookmarking.</p>
    <label style="display:flex;align-items:center;margin-top:1em;">
      <input type="checkbox" id="dont-remind-bookmark" style="margin-right:8px;"> Don't remind me again
    </label>
    <div style="margin-top:1.5em;text-align:right;">
      <button id="bookmark-modal-ok" class="primary-btn">OK</button>
    </div>
  </div>
</div>
<script src="eval.js"></script>
</body>
</html> 